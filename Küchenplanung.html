<!DOCTYPE html>
<html>
<head>
    <title>Kuchenplanung</title>
    <meta charset="utf-8">
    <script>
        let days = ["Montag", "Dienstag", "Mittwoch", "Donnerstag", "Freitag", "Samstag", "Sonntag"];

        let tasks = [{
            name: "Spühlmaschine",
            days: [0,1,2,3,4],
            complexity: 3
        },{
            name: "Townhall",
            days: [0,1,2,3,4],
            complexity: 2
        },{
            name: "Wasserkocher",
            days: [2],
            complexity: 1
        },{
            name: "Sirup",
            days: [3],
            complexity: 1
        },];

        let employees = ["Daniel", "Andreas", "Julia", "Florian", "Imke", "Pascal"];

        let tasksList = createTasksList(tasks);

        tasksList = assignEmployeesToTasklist(tasksList, employees);

        createComplexity(employees, tasksList);

        manyDays();

        
        let tableHeader =["Tage / Aufgaben" ];
        let tableBody =[];



        //Console logs the current Week and Calender Week
        function date(){

            let today = new Date();
            let month = ["Januar","Februar","März","April","Mai","Juni","Juli","August","September","Oktober","November", "Dezember"];

            let first_Day = new Date(today.getFullYear(),today.getMonth(),today.getDate() - today.getDay()+1);
            let last_Day =new Date (today.getFullYear(),today.getMonth(),today.getDate() - today.getDay()+7);

            let fd = first_Day.getDate();
            let fm = first_Day.getMonth();

            let ld = last_Day.getDate();
            let lm = last_Day.getMonth();
            let ly = last_Day.getFullYear();


            let first= fd+"."+month[fm];

            let last = ld+"."+month[lm]+" "+ly+" ";


            //computed the weeknumber 
            Date.prototype.getWeek = function() {
                let onejan = new Date(this.getFullYear(), 0, 1);
                return Math.ceil((((this - onejan) / 86400000) + onejan.getDay() + 1) / 7);
            };

            let weekNumber = (new Date()).getWeek();

            console.log("Küchenplan im Zeitraum vom "+first+" bis "+last+"(KW "+ weekNumber + ")");
            //+weekNumber+

        }date();



        //fills the Array for the Header with the task Names
        function headerArray(){

            for(let i= 0; i < tasks.length; i++){
                tableHeader.push(tasks[i].name);
            }

        }headerArray();

        //Creates an Object for each task with name/day/complexity/employee in TasksList
        function createTasksList(tasks){
            let tasksList = [];
            tasks.forEach(function(element) {
                element.days.forEach(function(nextElement){
                    tasksList.push({
                        name: element.name,
                        day: nextElement,
                        complexity: element.complexity,
                        employee:"",
                    });
                })

            });
            console.log(tasksList);
            return tasksList;
        }

        //Fills the EmployeePool with the employees who have the lowest Complexity Points and assigns them the next Task
        function assignEmployeesToTasklist(tasksList, employees){
            let employeesComplexity = createComplexity(employees);
                //fill employee Pool
            let employeePool = nextEmployees(employeesComplexity);

            tasksList.forEach(function(task){
                let nexEmployee = employeePool.shift();
                task.employee = nexEmployee.name;

                addEmployeeComplexity(employeesComplexity, nexEmployee.name, task.complexity);

                //refill employee Pool
             if (employeePool.length === 0){
                 employeePool = nextEmployees(employeesComplexity);
                }
            });
            console.log(tasksList)
            return tasksList;
        }


        //creates an Array with every name and their complexity
        function createComplexity(employees){
            let employeesComplexity = [];

            employees.forEach(function(employees){
                employeesComplexity.push({
                    name : employees,
                    complexity :0
                });
            });
            console.log(employeesComplexity);
            return employeesComplexity ;
        }


        //sorts the array with the Employees/Complexity and return the Employees with the lowest Complexity
        function nextEmployees(employeesComplexity){
            let lowestComplexity = employeesComplexity.sort(function(a, b){

                return a.complexity - b.complexity;

            })[0].complexity;

            let filterdComplexity = employeesComplexity.filter(function(employee) {return employee.complexity === lowestComplexity});
            return filterdComplexity;
        }


        //Adds the new Complexity points to the Array
        function addEmployeeComplexity(employeesComplexity, name, complexity){
            let employee = employeesComplexity.find(function(employee) { return employee.name === name});

            employee.complexity += complexity;
        }

        //Loops over the TaskList and gets the highest day
        function manyDays(){
            var maxDay = 0;
            tasksList.forEach(function(element){
                if(maxDay < element.day){
                    maxDay = element.day;
                }
            });

            return maxDay;
        }


        //Creates row for each Day and fills them Employees
        function bodyArray(){
            for(i= 0; i <= manyDays(); i++){
                let row = [];

                row.push(days[i]);
                tasks.forEach((task) => {
                    let columnTask = tasksList.find((taskListItem) =>{
                        return taskListItem.day === i && taskListItem.name === task.name;
                    });
                    if(columnTask){
                        row.push(columnTask.employee);
                    }else{
                        row.push("");
                    }
                });


                tableBody.push(row);
            }

        }bodyArray();

        //Search the longest String  
        function longest_String(){
            var columLength = 0;

            for(let i = 0;  i < tableHeader.length; i++){
                var width =  tableHeader[i].length;
                if(width > columLength){
                    columLength = width;
                }
            }

            for(let j = 0; j <tableBody.length; j++){
                var width =  tableBody[j].length;

                if(width > columLength){
                    columLength = width;
                }
                for(let k=0;k < tableBody.length;k++){
                    var width =  tableBody[j][k].length;

                    if(width > columLength){
                        columLength = width;
                    }
                }
            }
            
            return columLength;
        }
        var longest = longest_String();
        // create the complete Table ham
        function render_Output(){
            
            //Renders Header Divider and the Body
            function renderhead(tableHeader){
                let out = '|';


                tableHeader.forEach((Column)=> {
                    out += Column.padEnd(longest, " ");
                    out += ' | ';

                });

                console.log(out);

            }
            renderhead(tableHeader);

            //stripline length 
            let line = (longest_String() + 3) * tableHeader.length;

            //create the stripline
            let outline = '';
            for(i = 0; i < line; i++){
                outline += "-";
            }
            console.log(outline);

            // render the body
            function renderbody(tableBody){

                tableBody.forEach((row) => {
                    renderhead(row, longest_String());

                });
            }renderbody(tableBody, longest_String())

        }render_Output()

    </script>
</head>

<body>

</body>
</html>s